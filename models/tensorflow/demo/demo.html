<script src="https://unpkg.com/deeplearn"></script>
<script src="dist/bundle.js"></script>

<img id="cat"></img>
<div id="result"></div>

<script>
  const cat = document.getElementById('cat');
  cat.onload = async () => {
    const resultElement = document.getElementById('result');

    resultElement.innerText = 'Loading squeezenet tensorflow model...';

    // If dl isn't loaded, wait 1 second.
    if (dl == null) {
      await new Promise(resolve => setTimeout(resolve, 1000));
    }

    const math = dl.ENV.math;
    const tfModel = new tfsqueezenet.SqueezeNet(math);
    console.time('load');
    await tfModel.load();
    console.timeEnd('load');

    resultElement.innerText = 'Predicting...';

    const pixels = dl.Array3D.fromPixels(cat);

    console.time('predict');
    const result = tfModel.predict(pixels);
    console.timeEnd('predict');

    resultElement.innerText = '';

    const topK = await tfModel.getTopKClasses(result, 5);
    for (const key in topK) {
      resultElement.innerText += `${topK[key].toFixed(5)}: ${key}\n`;
    };
  };
  cat.src = 'cat.jpg';
</script>
