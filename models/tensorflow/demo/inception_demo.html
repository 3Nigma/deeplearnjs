<script src="https://unpkg.com/deeplearn"></script>
<script src="dist/bundle.js"></script>

<img id="elephant"></img>
<div id="result"></div>

<script>
  const elephant = document.getElementById('elephant');
  elephant.onload = async () => {
    const resultElement = document.getElementById('result');

    resultElement.innerText = 'Loading mobilenet tensorflow model...';

    // If dl isn't loaded, wait 1 second.
    if (dl == null) {
      await new Promise(resolve => setTimeout(resolve, 1000));
    }

    const math = dl.ENV.math;
    const tfModel = new tfdemo.Inception(math);
    console.time('load');
    await tfModel.load();
    console.timeEnd('load');

    resultElement.innerText = 'Predicting...';

    const pixels = dl.Array3D.fromPixels(elephant);

    console.time('predict');
    const result = tfModel.predict(pixels);
    console.timeEnd('predict');

    resultElement.innerText = '';

    console.log(result.shape);
    const topK = await tfModel.getTopKClasses(result, 5);
    for (const key in topK) {
      resultElement.innerText += `${topK[key].toFixed(5)}: ${key}\n`;
    };
  };
  elephant.src = 'elephant2.jpg';
</script>
